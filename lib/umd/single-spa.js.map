{"version":3,"file":"single-spa.js","sources":["../../src/application/apps.helper.js","../../src/start.js","../../src/lifecycle/helper.js","../../src/application/timeout.js","../../src/lifecycle/load.js","../../src/lifecycle/bootstrap.js","../../src/lifecycle/unmount.js","../../src/lifecycle/mount.js","../../src/navigation/invoke.js","../../src/application/apps.js"],"sourcesContent":["/*\n * @Author: Aaron\n * @Date: 2020-05-03 13:34:29\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 22:08:28\n * @Description: file content\n */\n\n// 未加载（初始化的状态）\nexport const NOT_LOADED = 'NOT_LOADED'\n\n// APP加载错误\nexport const LOAD_ERROR = 'LOAD_ERROR'\n// APP变更状态时遇见错误\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN'\n\n// 加载APP\nexport const LOAD_SOURCE_CODE = 'LOAD_SOURCE_CODE'\n// 加载完成未启动\nexport const NOT_BOOTSTRAPPED = 'NOT_BOOTSTRAPPED'\n\n// 启动APP\nexport const BOOTSTRAPPING = 'BOOTSTRAPPING'\n// 启动完成未挂载\nexport const NOT_MOUNTED = 'NOT_MOUNTED'\n\n// 挂载APP\nexport const MOUNTING = 'MOUNTING'\n// 挂载完成\nexport const MOUNTED = 'MOUNTED'\n\n// 卸载APP\nexport const UNMOUNTING = 'UNMOUNTING'\n// 更新APP\nexport const UPDATEING = 'UPDATEING'\n\n\n// 过滤APP不是发生错误的APP\nexport function notSkip(app) {\n    return app.status !== SKIP_BECAUSE_BROKEN\n}\n// 过滤APP状态不是加载失败的\nexport function notLoadError(app) {\n    return app.status !== LOAD_ERROR\n}\n// 过滤APP状态为未加载的\nexport function notLoaded(app) {\n    return app.status === NOT_LOADED\n}\n// 过滤此APP为需要加载的APP\nexport function shouldBeActivity(app) {\n    try{\n        return app.activityWhen(window.location)\n    } catch(err) {\n        app.status = SKIP_BECAUSE_BROKEN\n        console.error(err)\n    }\n}\n// 过滤此APP为已经被挂载的\nexport function isMount(app) {\n    return app.status === MOUNTED\n}\n// 过滤此APP为需要被卸载的\nexport function shouldBeUnmount(app) {\n    return !shouldBeActivity(app)\n}\n// 过滤此APP为已经被加载的\nexport function isLoaded(app) {\n    return !notLoaded(app)\n}\n// 过滤此APP为没有被挂载的\nexport function isNtMount(app) {\n    return !isMount(app)\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-03 13:25:12\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-03 13:45:46\n * @Description: file content\n */\n// 保存APP启动状态\nlet started = false\n\n// 启动APP\nexport function start() {\n    started = true\n}\n\n// 获取APP启动状态\nexport function isStarted() {\n    return started\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-03 14:24:48\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 21:20:38\n * @Description: file content\n */\n\n// 判断是否为一个promise\nexport function isNotPromise(promise) {\n    if (promise instanceof Promise) {\n        return true\n    }\n\n    return typeof promise === 'object' && typeof promise.then === 'function' && typeof promise.catch === 'function'\n}\n\n// 处理多个promise顺序调用\nexport function flattenLifecycleArray (lifecycle, description) {\n    \n    if (!Array.isArray(lifecycle)) {\n        lifecycle = [lifecycle]\n    }\n\n    if (!lifecycle.length) {\n        lifecycle = [() => Promise.resolve({})]\n    }\n\n    return new Promise((resolve, reject) => {\n        (function waitForPromises(index) {\n            const fn = lifecycle[index]()\n\n            if (!isNotPromise(fn)) {\n                reject(new Error(`${description} has error`))\n            } else {\n                fn.then(() => {\n                    if (index >= lifecycle.length - 1) {\n                        resolve()\n                    } else {\n                        waitForPromises(++index)\n                    }\n                })\n                .catch(reject)\n            }\n        })(0)\n    })\n}\n\n// 获取APP信息传递到子应用中\nexport function getProps({name, customProps}) {\n    return {\n        name,\n        ...customProps\n    }\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-05 21:25:35\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 21:38:08\n * @Description: file content\n */\nconst TIMEOUT = {\n    bootstrap: {\n        milliseconds: 3000,\n        rejectWhenTimeout: false\n    },\n    mount: {\n        milliseconds: 3000,\n        rejectWhenTimeout: false\n    },\n    unmount: {\n        milliseconds: 3000,\n        rejectWhenTimeout: false\n    }\n}\n\n// 超时处理\nexport function reasonableTime(lifecyclePromise, description, timeout) {\n    return new Promise((resolve, reject) => {\n        let finished = false\n\n        lifecyclePromise.then((data) => resolve(data)).finally(() => finished = true)\n\n        const timer = setTimeout(() => {\n            clearTimeout(timer)\n            if (!finished && timeout.rejectWhenTimeout) {\n                reject(new Error(description))\n            }\n        }, timeout.rejectWhenTimeout)\n    })\n}\n\nexport function ensureTimeout(timeout = {}) {\n    return {\n        ...TIMEOUT,\n        ...timeout\n    }\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-03 14:20:24\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 22:17:56\n * @Description: file content\n */\nimport { NOT_LOADED, LOAD_SOURCE_CODE , SKIP_BECAUSE_BROKEN, NOT_BOOTSTRAPPED , LOAD_ERROR} from '../application/apps.helper';\nimport { isNotPromise, flattenLifecycleArray, getProps } from './helper'\nimport { ensureTimeout } from '../application/timeout'\n\n// 加载APP\nexport function toLoadPromise(app) {\n    if (app.status !== NOT_LOADED) {\n        return Promise.resolve(app)\n    }\n\n    app.status = LOAD_SOURCE_CODE\n\n    const props = getProps(app)\n\n    const loadPromise = app.loadFunction(props)\n\n    if (!isNotPromise(loadPromise)) {\n        app.status = SKIP_BECAUSE_BROKEN\n        return Promise.reject(new Error('loadFunction 必须返回一个 Promise'))\n    }\n\n    loadPromise.then(appConfig => {\n        if (typeof appConfig !== 'object') {\n            app.status = SKIP_BECAUSE_BROKEN\n            throw new Error('')\n        }\n\n        const isComplete = ['bootstrap', 'mount', 'unmount'].every(lifecycle => {\n            \n            if (!appConfig[lifecycle]) {\n                app.status = SKIP_BECAUSE_BROKEN\n                console.error(`${app.name} `)\n                return false\n            }\n            app.timeout = ensureTimeout(appConfig.timeout)\n            app[lifecycle] = flattenLifecycleArray(appConfig[lifecycle], `${app.name} ${lifecycle}`)\n        })\n\n        if (isComplete) {\n            app.status = NOT_BOOTSTRAPPED\n        }\n    }).catch(e => {\n        console.error(e)\n        app.status = LOAD_ERROR\n    })\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-05 22:17:25\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 22:50:32\n * @Description: file content\n */\n\nimport { BOOTSTRAPPING, NOT_BOOTSTRAPPED, SKIP_BECAUSE_BROKEN, NOT_MOUNTED } from \"../application/apps.helper\"\nimport {reasonableTime} from '../application/timeout';\nimport {getProps} from './helper';\n\n// 启动APP\nexport function toBootstrapPromise(app) {\n    if (app.status !== NOT_BOOTSTRAPPED) {\n        return Promise.resolve(app)\n    }\n\n    app.status = BOOTSTRAPPING\n\n    const props = getProps(app)\n\n    return reasonableTime(\n        app.bootstrap(props),\n        `app ${app.name} bootstrapping`,\n        app.timeout.bootstrap\n    ).then(() => {\n        app.status = NOT_MOUNTED\n        return app\n    }).catch(e => {\n        console.error(e)\n        app.status = SKIP_BECAUSE_BROKEN\n    })\n}\n","/*\n * @Author: Aaron\n * @Date: 2020-05-05 22:17:25\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 23:01:30\n * @Description: file content\n */\n\nimport { MOUNTED , SKIP_BECAUSE_BROKEN, NOT_MOUNTED} from \"../application/apps.helper\";\nimport {reasonableTime} from '../application/timeout';\nimport {getProps} from './helper';\n\n// 卸载APP\nexport function toUnmountPromise(app) {\n    if (app.status !== MOUNTED) {\n        return Promise.resolve(app)\n    }\n\n    const props = getProps(app)\n\n    return reasonableTime(\n        app.unmount(props),\n        `app ${app.name} unmounting`,\n        app.timeout.unmount\n    ).then(() => {\n        app.status = NOT_MOUNTED\n        return app\n    }).catch(e => {\n        console.error(e)\n        app.status = SKIP_BECAUSE_BROKEN\n    })\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-05 22:17:25\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 23:04:43\n * @Description: file content\n */\n\nimport { NOT_MOUNTED , MOUNTED } from \"../application/apps.helper\"\nimport { reasonableTime } from '../application/timeout'\nimport { getProps } from './helper'\nimport { toUnmountPromise } from './unmount'\n\n// 挂载APP\nexport function toMountPromise(app) {\n    if (app.status !== NOT_MOUNTED) {\n        return Promise.resolve(app)\n    }\n\n    const props = getProps(app)\n\n    return reasonableTime(\n        app.mount(props),\n        `app ${app.name} mounting`,\n        app.timeout.mount\n    ).then(() => {\n        app.status = MOUNTED\n        return app\n    }).catch(e => {\n        console.error(e)\n        app.status = MOUNTED\n        return toUnmountPromise(app)\n    })\n}","/*\n * @Author: Aaron\n * @Date: 2020-05-03 13:43:21\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 22:19:36\n * @Description: file content\n */\n\nimport { isStarted } from '../start'\nimport { getAppsToLoad, getAppsToUnmount, getAppsToMount } from '../application/apps'\nimport { toLoadPromise } from '../lifecycle/load'\nimport { toBootstrapPromise } from '../lifecycle/bootstrap'\nimport { toMountPromise } from '../lifecycle/mount'\nimport { toUnmountPromise } from '../lifecycle/unmount'\nimport { SKIP_BECAUSE_BROKEN } from '../application/apps.helper';\n\nlet appChangesUnderway = false\nlet changesQueue = []\n\n// 加载APP\nexport function invoke() {\n    if (appChangesUnderway) {\n        return new Promise((resolve, reject) => {\n            changesQueue.push({\n                success: resolve,\n                failure: reject\n            })\n        })\n    }\n\n    appChangesUnderway = true\n\n    // APP是否已被手动调用启动\n    if (isStarted()) {\n        performAppChanges()\n    } else {\n        // 按需预加载\n        loadApps()\n    }\n\n    // 加载APP\n    function loadApps() {\n        // 获取需要被load的APP\n        const apps = getAppsToLoad()\n\n        // 对APP足个进行加载\n        apps.map(toLoadPromise)\n    }\n\n    // 切换应用（先卸载，在加载）\n    function performAppChanges() {\n        // 1. unmount 不需要的APP\n        getAppsToUnmount().map(toUnmountPromise)\n        // 2. load 需要加载的APP\n        getAppsToLoad().map(app => {\n            toLoadPromise(app).then(toBootstrapPromise).catch(e => {\n                console.error(e)\n                app.status = SKIP_BECAUSE_BROKEN\n            })\n        })\n        // 3. mount 需要挂载的APP\n        getAppsToMount().map(toMountPromise)\n    }\n}\n","/*\n * @Author: Aaron\n * @Date: 2020-05-03 13:25:22\n * @LastEditors: Aaron\n * @LastEditTime: 2020-05-05 22:09:54\n * @Description: file content\n */\n\nimport {\n    NOT_LOADED,\n    notSkip,\n    notLoadError,\n    notLoaded,\n    isMount,\n    isLoaded,\n    isNtMount,\n    shouldBeUnmount,\n    shouldBeActivity\n} from './apps.helper'\nimport { invoke } from '../navigation/invoke'\n\nconst APPS = []\n\n/**\n * 注册APP\n * \n * @export\n * @param {string} name 要注册的APP名称\n * @param {Function<Promise> | Object} loadFunction APP异步加载函数或APP内容\n * @param {Function<boolean>} activityWhen 判断APP是否需要挂载\n * @param {Object} customProps 自定义配置\n * @returns {Promise}\n */\nexport function registerApplication(name, loadFunction, activityWhen, customProps = {}) {\n    if (!name || typeof name !== 'string') {\n        throw new Error('name 必须是一个字符串')\n    }\n\n    if (!loadFunction) {\n        throw new Error('loadFunction 必须是一个函数或对象')\n    }\n\n    if (typeof loadFunction !== 'function') {\n        loadFunction = () => Promise.resolve(loadFunction)\n    }\n\n    if (typeof activityWhen !== 'function') {\n        throw new Error('activityWhen 必须是一个函数')\n    }\n\n    APPS.push({\n        name,\n        loadFunction,\n        status: NOT_LOADED,\n        activityWhen,\n        customProps\n    })\n\n    invoke()\n}\n\n// 过滤需要加载的APP\nexport function getAppsToLoad() {\n    return APPS.filter(notSkip)\n    .filter(notLoadError)\n    .filter(notLoaded)\n    .filter(shouldBeActivity)\n}\n\n// 过滤需要被卸载的APP\nexport function getAppsToUnmount() {\n    return APPS.filter(notSkip)\n    .filter(isMount)\n    .filter(shouldBeUnmount)\n}\n\n// 过滤需要被挂载的APP\nexport function getAppsToMount() {\n    return APPS.filter(notSkip)\n    .filter(isLoaded)\n    .filter(isNtMount)\n    .filter(shouldBeActivity)\n}"],"names":["NOT_LOADED","LOAD_ERROR","SKIP_BECAUSE_BROKEN","LOAD_SOURCE_CODE","NOT_BOOTSTRAPPED","BOOTSTRAPPING","NOT_MOUNTED","MOUNTED","notSkip","app","status","notLoadError","notLoaded","shouldBeActivity","activityWhen","window","location","err","console","error","isMount","shouldBeUnmount","isLoaded","isNtMount","started","start","isStarted","isNotPromise","promise","Promise","then","catch","flattenLifecycleArray","lifecycle","description","Array","isArray","length","resolve","reject","waitForPromises","index","fn","Error","getProps","name","customProps","TIMEOUT","bootstrap","milliseconds","rejectWhenTimeout","mount","unmount","reasonableTime","lifecyclePromise","timeout","finished","data","finally","timer","setTimeout","clearTimeout","ensureTimeout","toLoadPromise","props","loadPromise","loadFunction","appConfig","isComplete","every","e","toBootstrapPromise","toUnmountPromise","toMountPromise","appChangesUnderway","invoke","performAppChanges","loadApps","apps","getAppsToLoad","map","getAppsToUnmount","getAppsToMount","APPS","registerApplication","push","filter"],"mappings":"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"}